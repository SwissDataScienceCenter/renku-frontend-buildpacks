name: Build RenkuLab image
description: Action to build images to use on the RenkuLab platform
inputs:
  frontend:
    description: Frontend to add to the image
    required: false
    default: vscodium
  tags:
    description: Comma-separated list of image tags to apply
    required: false
    default: ghcr.io/${{ github.repository }}/renku-image:latest
  builder:
    description: Builder to use
    required: false
    default: ghcr.io/swissdatasciencecenter/renku-frontend-buildpacks/selector:0.0.8
  run-image:
    description: Run image to use
    default: ghcr.io/swissdatasciencecenter/renku-frontend-buildpacks/base-image:0.0.8
    required: false
runs:
  using: "composite"
  steps:
    - uses: buildpacks/github-actions/setup-pack@v5.9.3
    - id: build-image
      shell: bash
      run: |
        TAGS=${{ inputs.tags }}
        FIRST_TAG=${TAGS%%,*}
        pack build $FIRST_TAG \
          -p . \
          --builder ${{ inputs.builder }} \
          --run-image ${{ inputs.run-image }} \
          --env BP_RENKU_FRONTENDS=${{ inputs.frontend }} \
          --tag $TAGS \
          --publish
